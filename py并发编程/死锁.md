### 死锁定义

死锁是指多个线程因为竞争资源而造成的一种僵局（互相等待），若没有外力作用，这些进程将会无法向前推进

#### 产生死锁的原因

**a：竞争资源**

系统中的资源可以分为两类：

可剥夺资源是指某进程在获得这类资源后，该资源可以在被其他进程或系统剥夺，CPU和主存均属于可剥夺性资源

不可剥夺资源：当系统把这类资源分配个某个进程后，不能再强行收回，只能等进程用完后自行释放，比如磁带机，打印机等

1. 产生死锁中的竞争资源之一指的是竞争不可剥夺资源

例如：有一台打印机，P1进程正在占用，如果P2进程也是用打印机，打印机将会阻塞

2. 产生死锁中的竞争资源是指竞争临时资源（信号，消息，缓冲区中的消息等），通常消息通信顺序不当会产生死锁

**b：进程间推进顺序不合理**

如果并发进程，P1保持了资源R1，P2保持了资源R2，而p1申请资源p2，进程p2申请资源p1都会触发死锁

例如：A要前进两步在后退两步，但执行顺序有误，A先后退，便触发不了后续的步骤死锁住

**c：信号量使用不当造成等待**

P1等待P2的消息，P2等待P1的消息，并不是因为竞争资源，而是在等待资源，同样会发生死锁的情况



#### 产生死锁的四个必要条件

产生死锁则四个条件必然成立，不满足一个便不会发生死锁，所以避免死锁只要破坏其中的条件

1. 互斥条件

   涉及的资源是非共享的，即一次只能有一个进程使用。如果有另一个进程申请该资源，那么申请进程必须等待，直到该资源被释放。

2. 不剥夺条件（非抢占）

   进程所获得的资源在未使用完毕之前，不能被其他进程强行夺走，即只能由获得该资源的进程进行释放

3. 占有并等待（部分分配）

   进程每次申请他所需要的一部分资源，在等待一新资源的同时，进程继续占用已分配到的资源

4. 环路条件（循环等待）

   存在一种进程首尾相接的循环链，链中的每个进程都在等待下一个进程所持有的资源，造成这组进程处于永远等待的状态