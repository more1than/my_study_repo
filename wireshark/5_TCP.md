## TCP

ISN（Initial Sequence Number 初始化序列号）不是固定的，是动态生成的

ACK报文是用来应答的，SYN报文是用来同步的，FIN报文是用来请求关闭的



### 三次握手

第一次握手：客户端给服务器段发送一个**SYN**报文，并指明初识序列号**ISN**，此时客户端处于SYN_SEND状态，首部的同步位**SYN=1**，初始序号seq=x

第二次握手：服务器接收到客户端的**SYN**报文后，回忆自己的**SYN**报文作为应答，同时会把客户端的**ISN+1**作为自己的**ACK**，表示已经收到了客户端的SYN，此时服务器处于SYN_RCVD状态

第三次握手：客户端收到**SYN**报文后，会发送一个**ACK**报文，也是把服务器的**ISN+1**作为ACK的值这是双方建立起了连接



### 四次挥手

第一次挥手：客户端发送**FIN**报文，请求断开连接

第二次挥手：服务端发送**ACK**报文确认

第三次挥手：服务端发送一个**FIN+ACK**，表示自己没有数据要发送了，想要断开连接，并进入最后确认状态

第四次挥手：客户端回复确认报文**ACK**，并等待计时器**2MSL**时间后，才是真正的断开连接

为什么要等待**2MSL**后才断开连接：因为最后一次**ACK**有可能丢包，**2MSL**是为了等待丢包后再次发送**ACK**



### SYN攻击是什么

因为三次握手的机制，导致有客户端发送给服务器SYN包，服务器便会确定并等待，进入半连接状态，而大量的仿造ip发送SYN给到服务器，有可能会导致服务器瘫痪，SYN攻击也是一种典型的Dos/DDos攻击

linux上可以使用netstat命令检测SYN攻击

```bash
netstat -n -p TCP | grep SYN_RECV
```

常见的防御方法：

1.缩短超时时间

2.增加最大半连接数

3.过滤网关防护

4.SYN cookie技术