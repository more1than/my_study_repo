### 网际控制报文协议ICMP

为了更有效地转发IP数据报和提高交付成功的机会，在网络层使用网际控制报文协议ICMP

主机或路由器使用ICMP来发送差错报告报文二号询问报文

ICMP报文被封装在IP数据包中发送

#### 共有五种：

终点不可达：当路由器或主机不能交付数据报时，就向源点发送重点不可达报文

源点抑制：当路由器或主机由于拥塞而丢弃数据报时，就向源点发送抑制报文，源点就知道把数据发送的速率放慢

时间超过：当路由器收到一个目的IP地址不是自己的IP数据报，会将其生存时间TTL字段的值减1，若不为0，则将该IP数据报转发出去

参数问题：当路由器或目的主机收到IP数据报后，根据其首部中的检验和字段发现参数出现误码，就丢弃该数据报

改变路由（重定向）：路由器把改变路由报文发送给主机，让主机知道下次应将数据报发送给另外的路由器

#### ICMP询问报文

回送请求报文：ICMP回送请求报文时由主机或路由器向一个特定的目的主机发出的询问，收到此报文的主机必须给源主机或路由器发送ICMP会送回答报文，**用来测试目的站是否可达**

#### 时间戳请求和回答

在ICMP时间戳回答报文中由一个32位的字段，其中写入的整数代表1900年1月1日起到当前时刻一共有多少秒

这种询问报文用来进行时钟同步和测量时间

#### ICMP的应用

分组网间探测PING：用来测试主机或路由器之间的连通性，应用层直接使用网际层协议ICMP，没有通过运输层的TCP或UDP，使用ICMP回送请求和回答报文

跟踪路由：用来测试IP数据包从源主机到达目的主机要通过哪些路由器

/> tracert www.baidu.com 命令