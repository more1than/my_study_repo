## 哨兵模式

当主机宕机后，需要手动把一台服务器切换为主服务器，这样费时费力，所以我们考虑使用哨兵模式，从Redis 2.8开始 Sentinel(哨兵)架构来解决

能够后台监控主机是否故障，如果故障根据投票数自动将从库转为主库

哨兵模式首先要开启一个独立的哨兵进行，通过发送命令等待Redis服务器响应，从而监控运行多个Redis实例

```
redis-sentinel
```



使用一个哨兵进程对Redis服务器进行监控，可能会出现问题，为此我们可以使用多个哨兵进行监控，各个哨兵之间还会进行监控，这样就形成了多哨兵模式。



如果主服务器宕机，哨兵1检测到，系统并不会马上进行failover，哨兵1主观认为主服务器不可用，这个现象称为主观下线，投票发起，failover后，会通过发布订阅模式让各个哨兵把自己监控的从服务器切换主机，这个过程称为客观下线



## 配置哨兵

1.配置哨兵配置文件sentinel.conf

```bash
# sentinel monitor 被监控的名称 host port 1
sentinel monitor myredis 127.0.0.1 6379 1 
```

后面这个数字1，代表主机挂了，slave投票看谁来接替成为主机，票数最多就会成为主机

2.启动哨兵！

```bash
redis-sentinel kconfig/sentinel.conf
```

如果主机已经被从机替换，主机又恢复连接，那主机只能当新主机的从机



### 优点：

1.哨兵集群基于主从复制模式，所有的主从配置优点他全都有

2.主从可以切换，故障可以转，系统的可用性就会更好

3.就是主从复制的升级，从自动到手动

### 缺点：

1.Redis不好在线扩容，集群容量如果到达上限，在线扩容很麻烦

2.实现哨兵模式的配置其实是很麻烦的，其中有很多的参数，选择

