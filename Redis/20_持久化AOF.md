### AOF持久化（Append Only File）

将所有的命令都记录下来，history恢复的时候就把这个文件全部都在执行一遍

以日志的形式记录每个写操作，将redis执行过的所有执行记录下来（读操作不记录），只许追加文件但不可以改写文件，redis启动之初会读取该文件重新构建数据，换而言之，redis重启的话就根据日志的内容将写执行冲前到后执行一次以完成数据的恢复

AOF保存的是appendonly.aof文件

默认AOF是不开启的，我们需要手动进行setting配置，只需要将appendonly给位yes

重启redis就可以生效了

### 如果aof文件出错

aof文件有问题是启动不了redis的，会报错，所以要先处理aof文件，先修复aof文件

redis提供了`redis--check-aof --fix`  （使用redis--check-aof文件传入fix参数）

如果文件正常重启就会恢复数据

### 如果aof文件大于64m，太大了！fork一个新的进程将我们的文件进行重写

### aof默认就是文件的无限追加，文件会越来越大！

优点：

1. 每一次修改都同步，文件完整性更好（更耗费性能）
2. 如果设置同步为每秒一次，有可能会丢失秒级数据

缺点：

1. 相对于数据文件来说，aof远远大于rdb，修复的速度也比rdb时间长
2. aof运行效率也比rdb慢，所以redis默认运行的是rdb而非aof

### 在主从复制中，rdb就是备用方案，从机上面使用，而aof基本不使用

