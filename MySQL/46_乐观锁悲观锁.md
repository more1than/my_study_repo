**悲观锁与乐观锁不仅局限于mysql中，只是一种概念，同样适用于redis等，只时不同技术实现方式有差别**



## 悲观锁

只想着最坏的情况，每次都认为别人会修改，所以每次拿数据都会上锁

悲观锁便是当一个线程想访问数据库时，先去申请锁，操作数据库过程中锁定数据库，其他用户访问数据库会阻塞，类似于事务隔离级别的最高级别：序列化



## 乐观锁

总是假设最好的情况，每次去拿数据的时候都认为别人不会修改

**一般使用版本号或CAS算法实现**

乐观的想法认为，每次拿数据的时候都没有人来拿数据，所以不会上锁，但操作完数据后会校验一下期间是否有人更新数据



适用于多读的应用类型，可以提高吞吐量

多写的场景使用悲观锁比较合适



### 乐观锁实现机制

### 版本号机制

在表中增加版本号字段，每次对数据修改之前，先查询版本号每次更新数据都会更新版本号，如果版本号不相同，则表示已经被他人更新，客户端进行提示并且不更新



### CAS算法（compare and swap 交换与比较）

是一种有名的无锁算法，在不使用锁的情况下实现多线程之间的变量同步，也就是在没有线程被阻塞的情况下实现变量的同步，算法涉及到三个操作数

> 需要读写的内存值：V
>
> 进行比较的值：A
>
> 拟写如的新值：B

当且仅当V的值等于A时，CAS通过原子方式用新增B来更新V的值，否则不会执行任何操作

### 乐观锁的ABA缺点

如果V初次读取的时候是A，并准备赋值的时候仍然是A，那么不能代表他的值没被修改过，因为有可能这个过程中改成别的值又改了回来，CAS算法会误以为没被修改过，这称之为ABA问题

