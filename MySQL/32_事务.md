### 什么是事务？

一个事务其实就是一个完整的业务逻辑

事务包括四个特性：

> A:原子性，说明事务是最小的工作单元，不可再分
>
> C:一致性，所有事务要求，在同一事务当中，所有操作必须同时成功或者同时失败
>
> I:隔离性，A事务和B事务之间具有一定的隔离
>
> 教室A和教室B中间有一道墙
>
> A事务操作一张表的时候，B事务也在操作一张表，多线程并发访问同一张表
>
> D:持久性，事务最终结束的一个保障，事务提交就相当于将没有保存到硬盘上的数据保存到硬盘上

### 什么是一个完整的业务逻辑？

> 假设转账，从A转账到B账户1W
>
> 将A账户的钱减去1W
>
> 将B账户的钱加上1W
>
> 这就是一个完整的业务逻辑

以上的操作就是一个最小的工作单元，要么同时成功，要么同时失败，不可再分



只有DML语句和事务有关，其他都与事务无关

insert   delete    update

只有以上三个语句与事务有关，因为只有这三个语句是对数据表中的数据进行增删改的，只要对数据进行增删改就会涉及到安全问题，数据安全第一位！！



什么是事务：

事务本质上就是多条DML语句同时成功或者同时失败



事务是怎么做到同时成功或同时失败的呢？

InnoDB存储引擎：提供一组用来记录事务性活动的日志文件

提交事务：清空事务性活动的日志文件，将数据全部彻底持久化到数据表中

提交事务标志着事物的结束，并且是一种全部成功的结束。

回滚数据：将之前的DML操作哦全部撤销，并且清空事务性活动的日志文件，回滚标志着事物的结束，并且是一种全部失败的结束。



### 原子性  undo log

数据回滚时会对数据进行相反的操作，如delete操作回滚会实现insert操作插入回去

### 持久性 redo log

数据库持久化时会将数据存到buffer中，buffer定期向硬盘中存储，这时如果mysql宕机而buffer又未更新进磁盘中会出现数据丢失的情况，这时就引入了redo log，先把数据写入redo log 中再存入buffer中，从而保证数据持久性，redo log采用顺序io写入磁盘，速度快于buffer的随机io写入

### 一致性

事务执行之后，数据库的完整性约束没有被破坏，一致性是事务追求的最终目标，其他三个特性是为了保证一致性

### 隔离性

写-写操作通过锁实现

读-写操作通过MVCC实现